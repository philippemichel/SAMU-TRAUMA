---
subtitle: "Rapport statistique v1.0"
cache: false
---

```{r}
#| label: info

rm(list = ls())
load("datas/samutraumas.RData")
#
library(corrplot)
library(baseph)
library(ggsci)
library(janitor)
library(visdat)
library(GGally)
library(tidyverse)
library(kableExtra)
library(gtsummary)
library(forestmodel)
library(fmsb)
library(labelled)
#
classeur <- "samutraumas.ods"
expx <- FALSE
if (expx) {
  file.create(classeur)
  file.remove(classeur)
  write_ods(iris, classeur)
}

# sessionInfo()
theme_gtsummary_language(language = "fr", decimal.mark = ",")
theme_gtsummary_journal(journal = "jama")
options(OutDec = ",")
ptest <- list(all_continuous() ~ "wilcox.test", all_categorical() ~ "chisq.test")
#
load("datas/samutraumas.RData")
```



# Qualité des données

## Corrélations anormales

```{r}
#| label: cor-prep

corx <- function(prof, titx) {
  tit <- paste0("Corrélations ", titx)
  prof |>
    remove_constant() |>
    mutate_if(is.factor, as.numeric) |>
    dplyr::select(!id) |>
    ggcorr(drop = TRUE, hjust = 0.9) +
    labs(
      title = tit,
      y = "n",
      caption = "Corrélations. Validation interne du questionnaire."
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(size = 14, face = "bold"),
      plot.subtitle = element_text(size = 12),
      axis.title.x = element_blank(),
      legend.title = element_blank(),
      axis.title.y = element_blank(), ,
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 12),
      legend.position = "right"
    )
}
```


```{r}
#| label: fig-corregul
#| fig-cap: Corrélations internes
#| eval: true
tt |> 
#  dplyr::select(-id) |> 
corx("")
```

Les seules corrélations inattendues & potentiellement gênantes sont celles entre `vittel_circonstance`, `vittel_pec` & `iss_tranche`. 

## Données manquantes

```{r}
#| label: fig-manq-apt
#| fig-cap: Données manquantes (questionnaire patient)

tt |> 
  dplyr::select(-c(id, horaire)) |> 
vis_dat(palette = "qual")
```

Le score ISS est très mal documenté. 

# Descriptif

Pour tous les tableaux, en cas de réponse en Oui/Non, seule la réponse `Oui` est affichée.

Les données concernent `r nrow(tt)` cas & sont réparties sur trois fichiers :

-   Régulation (`r ncol(regulation) - 1` variables)
-   Intervention (`r ncol(intervention) - 1` variables)
-   Destination (`r ncol(destination) - 1` variables)

## Régulation

```{r}
#| label: tbl-regul
#| tbl-cap: Description de la population - Régulation

regulation |> 
  dplyr::select(-id) |> 
  tbl_summary() |> 
  add_n() |>
  bold_labels() |>
  modify_header(label ~ " ") |>
  pexptabph(exp = expx, nomfich = classeur, nomsheet = "regul", lg = TRUE)
```




## Intervention

```{r}
#| label: tbl-inter
#| tbl-cap: Description de la population - Intervention

tt |> 
   dplyr::select(secondaire:transfusion_sanguine) |> 
  tbl_summary(missing = "no",
               type = list(secondaire ~ "dichotomous"),
             value = list(secondaire = "Oui",
                          demande_vsav = "Oui",
                          intox = "Oui",
                          vittel_examen_initial = "Oui",
                          vittel_circonstance = "Oui",
                          vittel_pec = "Oui",
                          vittel_lesions = "Oui",
                          vittel_caracteristiques = "Oui",
                          transfusion_sanguine = "Oui")
    ) |> 
  add_n() |>
  bold_labels() |>
  modify_header(label ~ " ") |>
  pexptabph(exp = expx, nomfich = classeur, nomsheet = "regul", lg = TRUE)
```

## Destination

```{r}
#| label: tbl-desti
#| tbl-cap: Description de la population - Destination

destination |> 
  dplyr::select(-c(id, triage, starts_with("destination"))) |> 
  tbl_summary() |> 
  add_n() |>
  bold_labels() |>
  modify_header(label ~ " ") |>
  pexptabph(exp = expx, nomfich = classeur, nomsheet = "desti", lg = TRUE)
```


# Critère principal

*Évaluation de l’orientation du patient traumatisé grave après bilan lésionnel post SMUR en sur trié, normo trié et sous trié.*

```{r}
#| label: tbl-princ1
#| tbl-cap: titre

tt |> 
  dplyr::select(triage) |> 
  tbl_summary( ) |> 
   add_n() |>
  bold_labels() |>
  modify_header(label ~ " ") |>
  pexptabph(exp = expx, nomfich = classeur, nomsheet = "princ1", lg = TRUE)
```

```{r}
#| label: tbl-reguldemog
#| tbl-cap: Qualité du triage selon l'âge & le sexe du patient

tt |> 
  dplyr::select(age, sexe, triage) |> 
  tbl_summary(by = triage, 
              percent = "row",
              missing = "no") |> 
  add_n() |>
  add_p() |>
  bold_labels() |>
  modify_header(label ~ " ") |>
  pexptabph(exp = expx, nomfich = classeur, nomsheet = "reguldemog", lg = TRUE)

```

Il y a plus de sur-triage chez les hommes. 

# Critères secondaires

## Critère 1

*Proportion de patients sous-triés sur les plages horaires.*

## Critère 2 & 3

*Proportion de sous-triage chez les patients avec une intoxication alcoolique ou toxique supposée.*

Vu le faible nombre de cas (une seule intoxication toxique) on regroupe les patients en un seul groupe `Intoxication alcoolique ou autre`.

## Critère 4

*Corrélation entre le grade de TRENAU et le niveau du trauma center pour l’admission finale.*

## Critère 5

*Nombre de patients avec un Shock-index positif lors de la prise en charge du SMUR orientés vers un trauma center de niveau 1.*

## Critère 6

*Nombre de patients avec un Shock-index positif lors de la prise en charge du SMUR et ayant eu une transfusion sanguine intra-hospitalière.*

# Technique

L'analyse statistique a été réalisée avec le logiciel **R**[rstat] & divers packages. Outre ceux cités dans le texte on a utilisé en particulier `tidyverse` [tidy] & `baseph` [baseph].

Un dépôt GitHub a été utilisé qui ne comprend que le code & non les données ou résultats. Au besoin un faux tableau de données sera présenté pour permettre des tests.

<https://github.com/philippemichel/SAMU-TRAUMAS/>


\addcontentsline{toc}{chapter}{C. Bibliographie}
